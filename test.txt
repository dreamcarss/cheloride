
<!DOCTYPE html>
<html>
<head>
  <title>PhonePe Checkout Example</title>
  <!-- Load the checkout.js bundle from PhonePe -->
  <script src="https://mercury.phonepe.com/web/bundle/checkout.js" defer></script>
</head>
<body>
  <h1>PhonePe Checkout Example</h1>
  <button onclick="initiatePayment()">Pay with PhonePe</button>

  <script>
    async function initiatePayment() {
  try {
    // Make a request to your backend to obtain the tokenUrl
    const response = await fetch('/pay', {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      },
    });

    if (response.ok) {
      const { tokenUrl } = await response.json();

      // Callback function to handle PayPage terminal state
      const callback = (response) => {
        if (response === 'USER_CANCEL') {
          console.log('Payment cancelled by user');
        } else if (response === 'CONCLUDED') {
          console.log('Payment process concluded');
        }
      };

      // Invoke PayPage in iFrame mode
      window.PhonePeCheckout.transact({ tokenUrl, callback, type: 'IFRAME' });
    } else {
      console.error('Error obtaining tokenUrl:', response.status);
    }
  } catch (error) {
    console.error('Error initiating payment:', error);
  }
}
  </script>
</body>
</html>