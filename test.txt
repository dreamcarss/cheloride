
<!DOCTYPE html>
<html>
<head>
  <title>PhonePe Checkout Example</title>
  <!-- Load the checkout.js bundle from PhonePe -->
  <script src="https://mercury.phonepe.com/web/bundle/checkout.js" defer></script>
</head>
<body>
  <h1>PhonePe Checkout Example</h1>
  <button onclick="initiatePayment()">Pay with PhonePe</button>

  <script>
async function initiatePayment() {
      try {
        const response = await fetch('/pay', {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
        },
        });

        if (response.ok) {
        const { tokenUrl } = await response.json();
        console.log(tokenUrl)

        const callback = (response) => {
            if (response === 'USER_CANCEL') {
            console.log('Payment cancelled by user');
            } else if (response === 'CONCLUDED') {
            console.log('Payment process concluded');
            }
        };

        window.PhonePeCheckout.transact({ tokenUrl, callback, type: 'IFRAME' });
        } else {
            console.error('Error obtaining tokenUrl:', response.status);
            }
        } catch (error) {
            console.error('Error initiating payment:', error);
        }
    }
  </script>
</body>
</html>


                fetch("/booking/book", {
                    method: 'POST',
                    headers: {
                    'Accept': 'application/json',
                    'token': localStorage.getItem("token"),
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                }).then((res => {
                     btn.removeAttribute("disabled")
                    res.json().then(data => {
                    btn.innerHTML = "Checkout"
                    const msg = document.createElement("div");
                    msg.classList.add("msg");
                    msg.innerHTML = `
                    <div class="bgcircle">
                    <ion-icon name=${res.status === 200 ? "checkmark" : "close"} style="color:${res.status === 200 ? " rgb(255, 255, 255)" : "red"}; font-size:70px"></ion-icon>
                    </div>
                    ${data.msg}
                    <a href="/booking" style="margin-top: 20px;">
                        <button class="btn" style=" font-size: 10px;">Your Bookings</button>
                    </a>`;
                    document.getElementsByTagName("body")[0].appendChild(msg);
                    setTimeout(() => {
                        window.location.href = "/booking"
                    }, 3000);
                }
                )}))